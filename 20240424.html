
<!doctype html><html><head><style>input[type='checkbox'] {display: none;}label:before {background: rgb(30, 150, 235);border-radius: 3px;height: 16px;width: 16px;display: inline-block;cursor: pointer;}input[type='checkbox'] + label:before {content: '';background: rgb(30, 150, 235);color: #fff;font-size: 16px;line-height: 16px;text-align: center;}input[type='checkbox']:checked + label:before {content: '✓';}</style></head><body><div style="width: 70vw; margin: 60px auto;"><h1>视频中所用到的python代码</h1><div class="affine-paragraph-block-container"><h2>app.py</h2><div class="affine-block-children-container" style="padding-left: 26px;"></div></div><pre><code class="code-python"><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> unsloth </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> FastLanguageModel</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> torch</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> trl </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> SFTTrainer</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> transformers </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> TrainingArguments</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">max_seq_length = </span><span style="word-wrap: break-word; color: #098658;">2048</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #008000;"># Choose any! We auto support RoPE Scaling internally!</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">dtype = </span><span style="word-wrap: break-word; color: #0000FF;">None</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #008000;"># None for auto detection. Float16 for Tesla T4, V100, Bfloat16 for Ampere+</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">load_in_4bit = </span><span style="word-wrap: break-word; color: #0000FF;">True</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #008000;"># Use 4bit quantization to reduce memory usage. Can be False.</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #008000;"># 4bit pre quantized models we support for 4x faster downloading + no OOMs.</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">fourbit_models = [</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/mistral-7b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/mistral-7b-instruct-v0.2-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/llama-2-7b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-7b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-7b-it-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># Instruct version of Gemma 7b</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-2b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-2b-it-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># Instruct version of Gemma 2b</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/llama-3-8b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># [NEW] 15 Trillion token Llama-3</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">] </span><span style="word-wrap: break-word; color: #008000;"># More models at https://huggingface.co/unsloth</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">model, tokenizer = FastLanguageModel.from_pretrained(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">model_name</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/llama-3-8b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">max_seq_length</span><span style="word-wrap: break-word; color: #000000;"> = max_seq_length,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">dtype</span><span style="word-wrap: break-word; color: #000000;"> = dtype,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">load_in_4bit</span><span style="word-wrap: break-word; color: #000000;"> = load_in_4bit,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #008000;"># token = "hf_...", # use one if using gated models like meta-llama/Llama-2-7b-hf</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">model = FastLanguageModel.get_peft_model(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    model,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">r</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">16</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># Choose any number > 0 ! Suggested 8, 16, 32, 64, 128</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">target_modules</span><span style="word-wrap: break-word; color: #000000;"> = [</span><span style="word-wrap: break-word; color: #A31515;">"q_proj"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #A31515;">"k_proj"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #A31515;">"v_proj"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #A31515;">"o_proj"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">                      </span><span style="word-wrap: break-word; color: #A31515;">"gate_proj"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #A31515;">"up_proj"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #A31515;">"down_proj"</span><span style="word-wrap: break-word; color: #000000;">,],</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">lora_alpha</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">16</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">lora_dropout</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">0</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># Supports any, but = 0 is optimized</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">bias</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"none"</span><span style="word-wrap: break-word; color: #000000;">,    </span><span style="word-wrap: break-word; color: #008000;"># Supports any, but = "none" is optimized</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #008000;"># [NEW] "unsloth" uses 30% less VRAM, fits 2x larger batch sizes!</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">use_gradient_checkpointing</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"unsloth"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># True or "unsloth" for very long context</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">random_state</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">3407</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">use_rslora</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #0000FF;">False</span><span style="word-wrap: break-word; color: #000000;">,  </span><span style="word-wrap: break-word; color: #008000;"># We support rank stabilized LoRA</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">loftq_config</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #0000FF;">None</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># And LoftQ</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">alpaca_prompt = </span><span style="word-wrap: break-word; color: #A31515;">"""Below is an instruction that describes a task, paired with an input that provides further context. Write a response that appropriately completes the request.</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #A31515;">### Instruction:</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #0000FF;">{}</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #A31515;">### Input:</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #0000FF;">{}</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #A31515;">### Response:</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #0000FF;">{}</span><span style="word-wrap: break-word; color: #A31515;">"""</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">EOS_TOKEN = tokenizer.eos_token </span><span style="word-wrap: break-word; color: #008000;"># Must add EOS_TOKEN</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #0000FF;">def</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #795E26;">formatting_prompts_func</span><span style="word-wrap: break-word; color: #000000;">(</span><span style="word-wrap: break-word; color: #001080;">examples</span><span style="word-wrap: break-word; color: #000000;">):</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    instructions = examples[</span><span style="word-wrap: break-word; color: #A31515;">"instruction"</span><span style="word-wrap: break-word; color: #000000;">]</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    inputs       = examples[</span><span style="word-wrap: break-word; color: #A31515;">"input"</span><span style="word-wrap: break-word; color: #000000;">]</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    outputs      = examples[</span><span style="word-wrap: break-word; color: #A31515;">"output"</span><span style="word-wrap: break-word; color: #000000;">]</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    texts = []</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #AF00DB;">for</span><span style="word-wrap: break-word; color: #000000;"> instruction, </span><span style="word-wrap: break-word; color: #795E26;">input</span><span style="word-wrap: break-word; color: #000000;">, output </span><span style="word-wrap: break-word; color: #AF00DB;">in</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #795E26;">zip</span><span style="word-wrap: break-word; color: #000000;">(instructions, inputs, outputs):</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #008000;"># Must add EOS_TOKEN, otherwise your generation will go on forever!</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        text = alpaca_prompt.format(instruction, </span><span style="word-wrap: break-word; color: #795E26;">input</span><span style="word-wrap: break-word; color: #000000;">, output) + EOS_TOKEN</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        texts.append(text)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #AF00DB;">return</span><span style="word-wrap: break-word; color: #000000;"> { </span><span style="word-wrap: break-word; color: #A31515;">"text"</span><span style="word-wrap: break-word; color: #000000;"> : texts, }</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">pass</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> datasets </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> load_dataset</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">file_path = </span><span style="word-wrap: break-word; color: #A31515;">"/home/Ubuntu/alpaca_data_cleaned.json"</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">dataset = load_dataset(</span><span style="word-wrap: break-word; color: #A31515;">"json"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #001080;">data_files</span><span style="word-wrap: break-word; color: #000000;">={</span><span style="word-wrap: break-word; color: #A31515;">"train"</span><span style="word-wrap: break-word; color: #000000;">: file_path}, </span><span style="word-wrap: break-word; color: #001080;">split</span><span style="word-wrap: break-word; color: #000000;">=</span><span style="word-wrap: break-word; color: #A31515;">"train"</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">dataset = dataset.map(formatting_prompts_func, </span><span style="word-wrap: break-word; color: #001080;">batched</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #0000FF;">True</span><span style="word-wrap: break-word; color: #000000;">,)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">trainer = SFTTrainer(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">model</span><span style="word-wrap: break-word; color: #000000;"> = model,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">tokenizer</span><span style="word-wrap: break-word; color: #000000;"> = tokenizer,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">train_dataset</span><span style="word-wrap: break-word; color: #000000;"> = dataset,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">dataset_text_field</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"text"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">max_seq_length</span><span style="word-wrap: break-word; color: #000000;"> = max_seq_length,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">dataset_num_proc</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">2</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">packing</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #0000FF;">False</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># Can make training 5x faster for short sequences.</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">args</span><span style="word-wrap: break-word; color: #000000;"> = TrainingArguments(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">per_device_train_batch_size</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">2</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">gradient_accumulation_steps</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">4</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">warmup_steps</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">5</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">max_steps</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">60</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">learning_rate</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">2e-4</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">fp16</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #AF00DB;">not</span><span style="word-wrap: break-word; color: #000000;"> torch.cuda.is_bf16_supported(),</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">bf16</span><span style="word-wrap: break-word; color: #000000;"> = torch.cuda.is_bf16_supported(),</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">logging_steps</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">1</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">optim</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"adamw_8bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">weight_decay</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">0.01</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">lr_scheduler_type</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"linear"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">seed</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">3407</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">output_dir</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"outputs"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    ),</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">trainer_stats = trainer.train()</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #008000;"># alpaca_prompt = Copied from above</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">FastLanguageModel.for_inference(model) </span><span style="word-wrap: break-word; color: #008000;"># Enable native 2x faster inference</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">inputs = tokenizer(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">[</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    alpaca_prompt.format(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">"Continue the fibonnaci sequence."</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># instruction</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">"1, 1, 2, 3, 5, 8"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># input</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">""</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># output - leave this blank for generation!</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    )</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">], </span><span style="word-wrap: break-word; color: #001080;">return_tensors</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"pt"</span><span style="word-wrap: break-word; color: #000000;">).to(</span><span style="word-wrap: break-word; color: #A31515;">"cuda"</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> transformers </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> TextStreamer</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">text_streamer = TextStreamer(tokenizer)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">_ = model.generate(**inputs, </span><span style="word-wrap: break-word; color: #001080;">streamer</span><span style="word-wrap: break-word; color: #000000;"> = text_streamer, </span><span style="word-wrap: break-word; color: #001080;">max_new_tokens</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">128</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">model.save_pretrained(</span><span style="word-wrap: break-word; color: #A31515;">"lora_model"</span><span style="word-wrap: break-word; color: #000000;">) </span><span style="word-wrap: break-word; color: #008000;"># Local saving</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">inputs = tokenizer(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">[</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    alpaca_prompt.format(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">"介绍AI超元域频道"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># instruction</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">""</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># input</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">""</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># output - leave this blank for generation!</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    )</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">], </span><span style="word-wrap: break-word; color: #001080;">return_tensors</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"pt"</span><span style="word-wrap: break-word; color: #000000;">).to(</span><span style="word-wrap: break-word; color: #A31515;">"cuda"</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> transformers </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> TextStreamer</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">text_streamer = TextStreamer(tokenizer)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">_ = model.generate(**inputs, </span><span style="word-wrap: break-word; color: #001080;">streamer</span><span style="word-wrap: break-word; color: #000000;"> = text_streamer, </span><span style="word-wrap: break-word; color: #001080;">max_new_tokens</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">128</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span></code></pre><div class="affine-paragraph-block-container"><p></p><div class="affine-block-children-container" style="padding-left: 26px;"></div></div><div class="affine-paragraph-block-container"><h2>test.py</h2><div class="affine-block-children-container" style="padding-left: 26px;"></div></div><pre><code class="code-python"><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> unsloth </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> FastLanguageModel</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> torch</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> trl </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> SFTTrainer</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> transformers </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> TrainingArguments</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">max_seq_length = </span><span style="word-wrap: break-word; color: #098658;">2048</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #008000;"># Choose any! We auto support RoPE Scaling internally!</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">dtype = </span><span style="word-wrap: break-word; color: #0000FF;">None</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #008000;"># None for auto detection. Float16 for Tesla T4, V100, Bfloat16 for Ampere+</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">load_in_4bit = </span><span style="word-wrap: break-word; color: #0000FF;">True</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #008000;"># Use 4bit quantization to reduce memory usage. Can be False.</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #008000;"># 4bit pre quantized models we support for 4x faster downloading + no OOMs.</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">fourbit_models = [</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/mistral-7b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/mistral-7b-instruct-v0.2-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/llama-2-7b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-7b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-7b-it-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># Instruct version of Gemma 7b</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-2b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/gemma-2b-it-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># Instruct version of Gemma 2b</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/llama-3-8b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># [NEW] 15 Trillion token Llama-3</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">] </span><span style="word-wrap: break-word; color: #008000;"># More models at https://huggingface.co/unsloth</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">model, tokenizer = FastLanguageModel.from_pretrained(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">model_name</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"unsloth/llama-3-8b-bnb-4bit"</span><span style="word-wrap: break-word; color: #000000;">,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">max_seq_length</span><span style="word-wrap: break-word; color: #000000;"> = max_seq_length,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">dtype</span><span style="word-wrap: break-word; color: #000000;"> = dtype,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #001080;">load_in_4bit</span><span style="word-wrap: break-word; color: #000000;"> = load_in_4bit,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #008000;"># token = "hf_...", # use one if using gated models like meta-llama/Llama-2-7b-hf</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">if</span><span style="word-wrap: break-word; color: #000000;"> </span><span style="word-wrap: break-word; color: #0000FF;">True</span><span style="word-wrap: break-word; color: #000000;">:</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    </span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> unsloth </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> FastLanguageModel</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    model, tokenizer = FastLanguageModel.from_pretrained(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">model_name</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"lora_model"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># YOUR MODEL YOU USED FOR TRAINING</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">max_seq_length</span><span style="word-wrap: break-word; color: #000000;"> = max_seq_length,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">dtype</span><span style="word-wrap: break-word; color: #000000;"> = dtype,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #001080;">load_in_4bit</span><span style="word-wrap: break-word; color: #000000;"> = load_in_4bit,</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    )</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    FastLanguageModel.for_inference(model) </span><span style="word-wrap: break-word; color: #008000;"># Enable native 2x faster inference</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">alpaca_prompt = </span><span style="word-wrap: break-word; color: #A31515;">"""Below is an instruction that describes a task, paired with an input that provides further context. Write a response that appropriately completes the request.</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #A31515;">### Instruction:</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #0000FF;">{}</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #A31515;">### Input:</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #0000FF;">{}</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #A31515;">### Response:</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #0000FF;">{}</span><span style="word-wrap: break-word; color: #A31515;">"""</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">inputs = tokenizer(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">[</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    alpaca_prompt.format(</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">"介绍AI超元域频道"</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># instruction</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">""</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># input</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">        </span><span style="word-wrap: break-word; color: #A31515;">""</span><span style="word-wrap: break-word; color: #000000;">, </span><span style="word-wrap: break-word; color: #008000;"># output - leave this blank for generation!</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">    )</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">], </span><span style="word-wrap: break-word; color: #001080;">return_tensors</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #A31515;">"pt"</span><span style="word-wrap: break-word; color: #000000;">).to(</span><span style="word-wrap: break-word; color: #A31515;">"cuda"</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #AF00DB;">from</span><span style="word-wrap: break-word; color: #000000;"> transformers </span><span style="word-wrap: break-word; color: #AF00DB;">import</span><span style="word-wrap: break-word; color: #000000;"> TextStreamer</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">text_streamer = TextStreamer(tokenizer)</span><span style="word-wrap: break-word; color: inherit;">
</span><span style="word-wrap: break-word; color: #000000;">_ = model.generate(**inputs, </span><span style="word-wrap: break-word; color: #001080;">streamer</span><span style="word-wrap: break-word; color: #000000;"> = text_streamer, </span><span style="word-wrap: break-word; color: #001080;">max_new_tokens</span><span style="word-wrap: break-word; color: #000000;"> = </span><span style="word-wrap: break-word; color: #098658;">128</span><span style="word-wrap: break-word; color: #000000;">)</span><span style="word-wrap: break-word; color: inherit;">
</span></code></pre><div class="affine-paragraph-block-container"><blockquote class="quote"><p>如有问题请联系我的的徽信：<strong>stoeng</strong></p></blockquote><div class="affine-block-children-container" style="padding-left: 26px;"></div></div><div class="affine-paragraph-block-container"><p></p><div class="affine-block-children-container" style="padding-left: 26px;"></div></div></div></body></html>
